// Generated by CoffeeScript 1.8.0
var argv, consul, filename, fs, httpAddr, key, minimist, usage;

usage = "\nUsage: consul-sync [options] key filename\n\n  Sync the value of the Consul key to the file contents\n\noptions:\n  --http-addr=127.0.0.1:8500    HTTP address of the Consul agent.\n";

minimist = require('minimist');

argv = minimist(process.argv.slice(2), {
  "default": {
    'http-addr': '127.0.0.1:8500'
  }
});

if (argv._.length !== 2) {
  console.error(usage);
  process.exit(1);
}

httpAddr = argv['http-addr'];

key = argv._[0];

filename = argv._[1];

consul = require('consul-utils');

fs = require('fs');

new consul.KV(httpAddr, key, function(configurations) {
  var error;
  try {
    fs.writeFileSync(filename, configurations[0].Value);
    return console.log("Updated " + filename + " with contents of " + key);
  } catch (_error) {
    error = _error;
    console.error("Error writing consul key " + key + " to " + filename);
    return console.error(error);
  }
});

console.log("Connecting to consul agent " + httpAddr);

console.log("Syncing changes from " + key + " to " + filename + "...");
